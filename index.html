import express from "express"
import cors from "cors"

const app = express()

app.use(cors())
app.use(express.json())

app.post("/analyze", (req, res) => {
  const userMessage = req.body.message.toLowerCase()

  const tipo = userMessage.includes("bitcoin") ? "bitcoin" :
               userMessage.includes("nft") ? "nft" :
               userMessage.includes("defi") ? "defi" : "otro"

  function calcularRiesgo(tipo) {
    switch(tipo){
      case "bitcoin": return Math.floor(Math.random() * 21) + 30
      case "nft": return Math.floor(Math.random() * 41) + 60
      case "defi": return Math.floor(Math.random() * 31) + 50
      default: return Math.floor(Math.random() * 21) + 40
    }
  }

  const riesgo = calcularRiesgo(tipo)

  const response = `
ðŸ”¥ ${tipo.toUpperCase()} detectado
ðŸ’° Riesgo: ${riesgo}/100
ðŸ§  Consejo: MantÃ©n estrategia y controla emociones.
  `

  console.log("Decision logged:", userMessage)

  res.json({response})
})

app.listen(3000, () => {
  console.log("ðŸš€ DeFi Relationship Agent corriendo en http://localhost:3000")
})
